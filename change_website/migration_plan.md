# s4.pd988.xyz 迁移工作计划

## 阶段一：准备工作 (已完成)

- [x] 创建 `s4.pd988.xyz` 文件夹。
- [x] 复制所有 `f5.ab311c.com` 的源文件。
- [x] 整理需要替换的接口清单。

## 2. 阶段二：寻找新接口 (已完成)

- [x] 在 `s4.pd988.xyz` 站点进行抓包。
- [x] 填写 `api_migration_list.md` 中的对比数据。
- [x] 确认新站的认证机制（Cookie `BMW`）。

## 3. 阶段三：代码替换与适配 (已完成)

### 3.1 基础架构调整
- [x] 修改 `data_manager.py` 中的 `base_url` 为 `https://s4.pd988.xyz`。
- [x] 在 `data_manager.py` 中添加金额缩放系数 `SCALE = 1000`。

### 3.2 核心逻辑重写
- [x] **数据抓取**: 重写 `get_realtime_data`，适配 `initHome` 和 `initUserInfo`。
- [x] **历史同步**: 重写 `fetch_remote_history`，适配 `showHistoryLottery` 及数字拼接逻辑。
- [x] **自动投注**: 重写 `BettingWorker.run`，适配 `lot/beting` 的 Form-data 格式及金额缩放。
- [x] **账单同步**: 重写 `AccountSyncWorker.run`，解析新的 `/queryOrderHistory` 响应。

### 3.3 验证工具适配
- [x] 修改 `test_api.py` 及相关测试脚本，确保能独立验证新站接口。

## 4. 阶段四：验证与测试 (已完成)

- [x] 运行 `test_api.py` 验证基础接口。
- [x] 启动模拟器，验证登录和余额抓取是否显示正确 (10000倍缩放校验：1元=10000厘)。
- [x] 验证历史数据同步功能是否能产生正确的本地 `canada28.txt`。
- [x] 进行小额真实下注测试，并在网站后台核对单据。

## 5. 阶段五：收尾与优化 (已完成)

- [x] **配置持久化**：将赔率、注单、策略参数、余额保护、止盈止损线等全量参数实现“即改即存”。
- [x] **号码池优化**：实现号码池内容的直接保存（`config.json`），摆脱路径依赖，实现“输入一次，持久有效”。
- [x] **UI体验优化**：修复日志中浮点数精度漂移问题（显示长串小数点），统一保留两位小数。
- [x] **功能修复**：修正止损输入框的范围限制，支持负数及大额止损输入。
- [x] **浏览器自动化**：实装浏览器加载后自动填入搜索词 `a1` 并自动点击搜索。
- [x] **双版本同步**：确保 `f5.ab311c.com` 和 `s4.pd988.xyz` 两个版本均获得上述所有改进。

## 6. 阶段六：构建与交付

- [/] 运行 `build_exe.py` 生成 s4 专属分发包。
- [ ] 交付客户验证。
